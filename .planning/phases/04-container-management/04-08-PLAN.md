---
phase: 04-container-management
plan: 08
type: execute
wave: 1
depends_on: []
files_modified: []
autonomous: true
gap_closure: true

must_haves:
  truths:
    - "Container creation succeeds without database column errors"
    - "Container detail page loads without Prisma validation errors"
    - "hostname field in schema matches database column"
  artifacts:
    - path: "apps/dashboard/prisma/migrations/20260210000000_add_hostname_fallback/migration.sql"
      provides: "Migration file for hostname column"
      status: "exists"
    - path: "database (Container table)"
      provides: "hostname column in PostgreSQL"
      status: "must_exist_after_migration"
  key_links:
    - from: "apps/dashboard/prisma/schema.prisma"
      to: "PostgreSQL Container table"
      via: "Prisma migration system"
      pattern: "prisma migrate"
---

<objective>
Apply the existing Prisma migration to add the `hostname` column to the PostgreSQL Container table.

Purpose: Close the gap between Prisma schema definition and database state. The schema.prisma has `hostname String?` field and Prisma Client was regenerated (Plan 04-07), but the migration file exists and has not been applied to the database yet.

Output: Database table matches Prisma schema, container creation and detail page loading work without validation errors.
</objective>

<execution_context>
@/home/coder/.config/Claude/get-shit-done/workflows/execute-plan.md
@/home/coder/.config/Claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

# Gap source

@.planning/phases/04-container-management/04-UAT.md

# Related fixes

@.planning/phases/04-container-management/04-07-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Apply Prisma migration to add hostname column</name>
  <files>apps/dashboard/prisma/migrations/20260210000000_add_hostname_fallback/migration.sql</files>
  <action>
Navigate to apps/dashboard and apply the existing Prisma migration:

```bash
cd apps/dashboard
npx prisma migrate deploy
```

This will:

1. Read the migration file at `prisma/migrations/20260210000000_add_hostname_fallback/migration.sql`
2. Execute `ALTER TABLE "Container" ADD COLUMN "hostname" TEXT;` against the PostgreSQL database
3. Record the migration in the `_prisma_migrations` table to mark it as applied

**Why `migrate deploy` not `migrate dev`:**

- `migrate deploy` applies pending migrations without prompting (CI/CD-safe)
- `migrate dev` is for development and would try to detect schema drift
- Migration file already exists from Plan 04-07, we just need to apply it

**Expected output:**

```
Applying migration `20260210000000_add_hostname_fallback`
The following migration(s) have been applied:

migrations/
  └─ 20260210000000_add_hostname_fallback/
    └─ migration.sql

Your database is now in sync with your schema.
```

**Gap reason:** Plan 04-07 created the migration file and regenerated Prisma Client, but did not apply the migration to the database. This left schema.prisma and generated client in sync, but database table out of sync.

Reference from 04-07-SUMMARY.md: Migration was created but the apply step was missing.
</action>
<verify>
After migration, verify the column exists in the database:

```bash
cd apps/dashboard
npx prisma db execute --stdin <<'SQL'
SELECT column_name, data_type, is_nullable
FROM information_schema.columns
WHERE table_name = 'Container' AND column_name = 'hostname';
SQL
```

Expected output showing hostname column with TEXT type and nullable:

```
column_name | data_type | is_nullable
hostname    | text      | YES
```

Also verify migration is recorded:

```bash
npx prisma db execute --stdin <<'SQL'
SELECT migration_name, finished_at
FROM _prisma_migrations
WHERE migration_name = '20260210000000_add_hostname_fallback';
SQL
```

Expected output showing the migration as applied with a timestamp.
</verify>
<done>

- Migration `20260210000000_add_hostname_fallback` is marked as applied in `_prisma_migrations` table
- Container table in PostgreSQL has `hostname` column (TEXT, nullable)
- Prisma schema, Prisma Client, and database table are all in sync
- Observable truth achievable: Container creation succeeds, detail page loads without "column does not exist" errors
  </done>
  </task>

</tasks>

<verification>
After migration applied:

1. **Schema sync check:**

   ```bash
   cd apps/dashboard
   npx prisma migrate status
   ```

   Expected: "Database schema is up to date!"

2. **Container creation test:**
   - Navigate to /containers/create wizard
   - Complete all steps and create a container
   - Should succeed without Prisma validation errors about missing hostname column

3. **Container detail test:**
   - Click on a container card from dashboard
   - Navigate to /containers/[id] detail page
   - Should load without "column does not exist" error
     </verification>

<success_criteria>

- `npx prisma migrate status` reports database in sync
- Container table has hostname column (verified via information_schema query)
- Container creation completes without database column errors
- Container detail page loads successfully
- UAT Test #8 can proceed (navigation to container detail works)
  </success_criteria>

<output>
After completion, create `.planning/phases/04-container-management/04-08-SUMMARY.md`
</output>
