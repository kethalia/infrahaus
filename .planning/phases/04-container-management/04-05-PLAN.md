---
phase: 04-container-management
plan: 05
type: execute
wave: 1
depends_on: []
files_modified:
  - apps/dashboard/src/components/app-sidebar.tsx
  - apps/dashboard/src/app/(dashboard)/page.tsx
  - apps/dashboard/src/components/containers/container-actions.tsx
  - apps/dashboard/src/components/containers/container-card.tsx
  - apps/dashboard/src/components/containers/container-grid.tsx
autonomous: true
gap_closure: true

must_haves:
  truths:
    - "Sidebar shows only distinct navigation items (Dashboard, Templates, Packages, Settings)"
    - "Dashboard page has Create Container button in header visible at all times"
    - "Container cards show loading state when lifecycle action is in progress"
  artifacts:
    - path: "apps/dashboard/src/components/app-sidebar.tsx"
      provides: "Sidebar without redundant Containers nav item"
    - path: "apps/dashboard/src/app/(dashboard)/page.tsx"
      provides: "Dashboard with Create Container button in header"
    - path: "apps/dashboard/src/components/containers/container-actions.tsx"
      provides: "Lifecycle actions with exposed isPending state"
    - path: "apps/dashboard/src/components/containers/container-card.tsx"
      provides: "Card with loading indicator for pending actions"
  key_links:
    - from: "container-grid.tsx"
      to: "container-card.tsx"
      via: "isPending prop passed to card"
    - from: "container-actions.tsx"
      to: "container-card.tsx"
      via: "onPendingChange callback for loading state"
---

<objective>
Fix navigation redundancy and add visible Create Container button; add card-level loading indicators for lifecycle actions

Purpose: Address UAT gaps #1 and #2 - sidebar had redundant Containers item (redirects to Dashboard), no way to create containers when containers exist, and lifecycle actions lack visible loading state when dropdown closes
Output: Clean sidebar navigation, always-visible Create button, visual loading feedback on container cards
</objective>

<execution_context>
@/home/coder/.config/opencode/get-shit-done/workflows/execute-plan.md
@/home/coder/.config/opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/STATE.md
@.planning/phases/04-container-management/04-UAT.md
@apps/dashboard/src/components/app-sidebar.tsx
@apps/dashboard/src/app/(dashboard)/page.tsx
@apps/dashboard/src/components/containers/container-actions.tsx
@apps/dashboard/src/components/containers/container-card.tsx
@apps/dashboard/src/components/containers/container-grid.tsx
</context>

<tasks>

<task type="auto">
  <name>Task 1: Remove redundant Containers nav item from sidebar</name>
  <files>apps/dashboard/src/components/app-sidebar.tsx</files>
  <action>
Remove the "Containers" item from navItems array in app-sidebar.tsx (lines 46-50).

The navItems array currently has:

- Dashboard (href: "/")
- Templates (href: "/templates")
- Packages (href: "/templates/packages")
- Containers (href: "/containers") ‚Üê REMOVE THIS
- Settings (href: "/settings")

Remove the entire Containers object from the array. The Containers link redirects to Dashboard anyway (containers/page.tsx has redirect("/")), so it's redundant and confusing.
</action>
<verify>grep -c "Containers" apps/dashboard/src/components/app-sidebar.tsx && grep -c "title: \"Containers\"" apps/dashboard/src/components/app-sidebar.tsx | grep -q "0" && echo "PASS" || echo "FAIL"</verify>
<done>Containers nav item removed from sidebar, only Dashboard/Templates/Packages/Settings remain</done>
</task>

<task type="auto">
  <name>Task 2: Add Create Container button to dashboard header</name>
  <files>apps/dashboard/src/app/(dashboard)/page.tsx</files>
  <action>
Add a Create Container button to the dashboard page header, visible regardless of whether containers exist.

Current page.tsx structure:

- Header with h1 "Dashboard" and description
- SummaryBar
- ContainerGrid

Add a Button component (asChild with Link) to the header row, positioned to the right of the title/description. Use the Plus icon from lucide-react. The button should link to "/containers/new".

Use shadcn Button component with variant="default" and size="sm".

Structure the header as a flex row with justify-between to place button on the right:

```
<div className="flex items-start justify-between gap-4">
  <div>
    <h1>Dashboard</h1>
    <p>description</p>
  </div>
  <Button asChild>
    <Link href="/containers/new">
      <Plus className="size-4" />
      Create Container
    </Link>
  </Button>
</div>
```

  </action>
  <verify>grep -q "Create Container" apps/dashboard/src/app/(dashboard)/page.tsx && grep -q '/containers/new' apps/dashboard/src/app/(dashboard)/page.tsx && echo "PASS" || echo "FAIL"</verify>
  <done>Create Container button visible in dashboard header, links to /containers/new</done>
</task>

<task type="auto">
  <name>Task 3: Add loading state to container cards during lifecycle actions</name>
  <files>
    apps/dashboard/src/components/containers/container-actions.tsx
    apps/dashboard/src/components/containers/container-card.tsx
    apps/dashboard/src/components/containers/container-grid.tsx
  </files>
  <action>
Add card-level loading indicators that persist when the dropdown menu closes during lifecycle actions.

Current issue: ContainerActions tracks isPending but only disables the dropdown trigger button. When dropdown closes, no visual feedback remains.

Changes needed:

1. **container-actions.tsx**:
   - Add `onPendingChange?: (isPending: boolean) => void` prop
   - Call onPendingChange(isPending) whenever isPending changes (useEffect)
   - Export isPending state upward

2. **container-card.tsx**:
   - Accept `isActionPending?: boolean` prop
   - When isActionPending is true, show a loading spinner overlay or animate the status badge
   - Use Loader2 icon with animate-spin class, positioned near status badge
   - Consider: wrap StatusBadge in a relative container with absolute positioned spinner

3. **container-grid.tsx**:
   - Track pending container IDs in state: `pendingContainers: Set<string>`
   - Pass `onPendingChange` callback to ContainerCard that updates this set
   - Pass `isActionPending={pendingContainers.has(container.id)}` to each ContainerCard

The loading indicator should be subtle but visible - a small spinner icon next to or replacing the status badge during operations. Use text-muted-foreground color for the spinner.
</action>
<verify>grep -q "onPendingChange" apps/dashboard/src/components/containers/container-actions.tsx && grep -q "isActionPending" apps/dashboard/src/components/containers/container-card.tsx && grep -q "pendingContainers" apps/dashboard/src/components/containers/container-grid.tsx && echo "PASS" || echo "FAIL"</verify>
<done>Container cards show loading spinner when lifecycle actions are in progress, persists when dropdown closes</done>
</task>

</tasks>

<verification>
- [ ] Sidebar shows only Dashboard, Templates, Packages, Settings (no Containers)
- [ ] Dashboard header has "Create Container" button visible
- [ ] Button navigates to /containers/new
- [ ] When lifecycle action starts, card shows loading indicator
- [ ] Loading indicator persists after dropdown closes
- [ ] Loading indicator clears when action completes
</verification>

<success_criteria>

- Sidebar navigation cleaned of redundant item
- Create Container button always accessible from dashboard
- Visual feedback during container lifecycle operations
  </success_criteria>

<output>
After completion, create `.planning/phases/04-container-management/04-05-SUMMARY.md`
</output>
