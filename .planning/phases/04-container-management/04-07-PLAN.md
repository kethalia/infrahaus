---
phase: 04-container-management
plan: 07
type: execute
wave: 1
depends_on: []
files_modified:
  - apps/dashboard/package.json
  - apps/dashboard/src/generated/prisma/client/index.d.ts
autonomous: true
gap_closure: true

must_haves:
  truths:
    - "Container creation wizard successfully creates containers with hostname field"
    - "Prisma Client recognizes hostname field from schema"
    - "No Prisma validation errors when creating containers"
  artifacts:
    - path: "apps/dashboard/src/generated/prisma/client/index.d.ts"
      provides: "Generated Prisma Client types including hostname field"
      contains: "hostname"
    - path: "apps/dashboard/package.json"
      provides: "Prisma generate in postinstall script"
      contains: "postinstall"
  key_links:
    - from: "apps/dashboard/prisma/schema.prisma"
      to: "apps/dashboard/src/generated/prisma/client"
      via: "prisma generate command"
      pattern: "hostname.*String"
---

<objective>
Regenerate Prisma Client and add postinstall hook to prevent schema/client drift

Purpose: Fix blocker where container creation fails with "Unknown argument `hostname`" because Prisma Client is out of sync with schema.prisma. Ensure future schema changes automatically regenerate the client.

Output: Synchronized Prisma Client with hostname field recognized, and postinstall script to prevent future drift.
</objective>

<execution_context>
@/home/coder/.config/Claude/get-shit-done/workflows/execute-plan.md
@/home/coder/.config/Claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/04-container-management/04-UAT.md
</context>

<tasks>

<task type="auto">
  <name>Regenerate Prisma Client with hostname field</name>
  <files>apps/dashboard/src/generated/prisma/client/</files>
  <action>
Run `pnpm prisma generate` in apps/dashboard directory to regenerate Prisma Client from the current schema.prisma.

This will sync the generated client with the schema, making the `hostname String?` field (line 156 in schema.prisma) available in the TypeScript types.

The schema already has:

```prisma
model Container {
  id           String             @id @default(cuid())
  vmid         Int                @unique
  hostname     String?            // LXC hostname for display
  // ... rest of fields
}
```

After generation, the client will recognize `hostname` in `prisma.container.create()` calls.
</action>
<verify>
Verify generated client includes hostname field:

```bash
grep -A 5 "hostname" apps/dashboard/src/generated/prisma/client/index.d.ts
```

Output should show `hostname?: string | null` in the Container type definition.
</verify>
<done>Prisma Client regenerated with hostname field in TypeScript types. Container creation in actions.ts will no longer fail with "Unknown argument `hostname`" error.</done>
</task>

<task type="auto">
  <name>Add postinstall script to prevent future drift</name>
  <files>apps/dashboard/package.json</files>
  <action>
Add a `postinstall` script to package.json that runs `prisma generate` after dependencies are installed.

This ensures that:

1. When team members run `pnpm install`, Prisma Client is automatically regenerated
2. When CI/CD runs install, client stays in sync
3. When switching branches with schema changes, client regenerates automatically

Current package.json has `prebuild` script for production builds, but no dev-time regeneration hook.

Add after line 7:

```json
"postinstall": "prisma generate",
```

Why postinstall vs predev:

- postinstall runs after `pnpm install` (one-time setup, branch switches)
- prebuild already covers production builds
- Together they cover all scenarios where schema/client can drift
  </action>
  <verify>
  Check package.json contains postinstall script:

```bash
grep -A 2 '"scripts"' apps/dashboard/package.json | grep postinstall
```

Output should show: `"postinstall": "prisma generate",`
</verify>
<done>package.json includes postinstall script. Future `pnpm install` runs will automatically regenerate Prisma Client, preventing schema/client drift.</done>
</task>

</tasks>

<verification>
Test container creation flow end-to-end:

1. Navigate to dashboard at http://localhost:3001
2. Click "Create Container" button
3. Fill out wizard steps (Template, Configure, Network, Review)
4. Submit creation

Expected: Container creation job enqueues successfully without Prisma validation errors. Progress page loads showing creation progress.

No longer see: `Invalid 'prisma.container.create()' invocation: Unknown argument 'hostname'`
</verification>

<success_criteria>

- Prisma Client regenerated with hostname field in generated types
- package.json includes postinstall script running `prisma generate`
- Container creation wizard works without Prisma validation errors
- UAT test #8 "Navigate to Container Detail" can proceed (blocker resolved)
  </success_criteria>

<output>
After completion, create `.planning/phases/04-container-management/04-07-SUMMARY.md`
</output>
