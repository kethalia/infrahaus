---
phase: 04-container-management
plan: 11
type: execute
wave: 1
depends_on: []
files_modified:
  - apps/dashboard/src/components/containers/detail/container-header.tsx
autonomous: true
gap_closure: true

must_haves:
  truths:
    - "Shutdown button shows confirmation dialog before executing"
    - "Start button shows confirmation dialog before executing"
    - "Stop and Delete continue to show confirmations (no regression)"
  artifacts:
    - path: "apps/dashboard/src/components/containers/detail/container-header.tsx"
      provides: "Expanded confirmDialog state with shutdown/start support"
      contains: '"shutdown" | "start"'
  key_links:
    - from: "Shutdown button onClick"
      to: "setConfirmDialog('shutdown')"
      via: "Dialog state instead of direct execution"
      pattern: "onClick=.*setConfirmDialog.*shutdown"
    - from: "Start button onClick"
      to: "setConfirmDialog('start')"
      via: "Dialog state instead of direct execution"
      pattern: "onClick=.*setConfirmDialog.*start"
---

<objective>
Add confirmation dialogs for Shutdown and Start lifecycle actions in container detail header.

Purpose: Stop and Delete actions show AlertDialog confirmations, but Shutdown and Start execute immediately without user confirmation. This creates inconsistent UX and risk of accidental actions. UAT Test 15 identified this as a minor but noticeable gap.

Output: Shutdown and Start actions require confirmation dialogs matching the existing Stop/Delete pattern.
</objective>

<execution_context>
@/home/coder/.config/opencode/get-shit-done/workflows/execute-plan.md
@/home/coder/.config/opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/debug/missing-confirmation-dialogs.md
@apps/dashboard/src/components/containers/detail/container-header.tsx
@apps/dashboard/src/components/ui/alert-dialog.tsx
</context>

<tasks>

<task type="auto">
  <name>Add confirmation dialogs for Shutdown and Start actions</name>
  <files>apps/dashboard/src/components/containers/detail/container-header.tsx</files>
  <action>
Modify `ContainerHeader` component to add confirmation dialogs for Shutdown and Start actions.

**1. Expand confirmDialog state type (line 61-63):**

OLD:

```typescript
const [confirmDialog, setConfirmDialog] = useState<"stop" | "delete" | null>(
  null,
);
```

NEW:

```typescript
const [confirmDialog, setConfirmDialog] = useState<
  "start" | "shutdown" | "stop" | "delete" | null
>(null);
```

**2. Update Start button onClick (around line 197-206):**

Find the Start button definition. Currently has:

```typescript
onClick = { handleStart };
```

Change to:

```typescript
onClick={() => setConfirmDialog("start")}
```

**3. Update Shutdown button onClick (around line 220-230):**

Find the Shutdown button definition. Currently has:

```typescript
onClick = { handleShutdown };
```

Change to:

```typescript
onClick={() => setConfirmDialog("shutdown")}
```

**4. Add Start confirmation AlertDialog (after existing dialogs, around line 360):**

Add before the closing return parenthesis:

```typescript
{/* Start Confirmation Dialog */}
<AlertDialog
  open={confirmDialog === "start"}
  onOpenChange={(open) => !open && setConfirmDialog(null)}
>
  <AlertDialogContent>
    <AlertDialogHeader>
      <AlertDialogTitle>Start Container?</AlertDialogTitle>
      <AlertDialogDescription>
        This will start <strong>{displayName}</strong> and boot all configured
        services. The container will consume resources until stopped.
      </AlertDialogDescription>
    </AlertDialogHeader>
    <AlertDialogFooter>
      <AlertDialogCancel disabled={isStarting}>Cancel</AlertDialogCancel>
      <AlertDialogAction
        onClick={handleStart}
        disabled={isStarting}
        className="bg-green-600 hover:bg-green-700"
      >
        {isStarting ? "Starting..." : "Start Container"}
      </AlertDialogAction>
    </AlertDialogFooter>
  </AlertDialogContent>
</AlertDialog>
```

**5. Add Shutdown confirmation AlertDialog (after Start dialog):**

```typescript
{/* Shutdown Confirmation Dialog */}
<AlertDialog
  open={confirmDialog === "shutdown"}
  onOpenChange={(open) => !open && setConfirmDialog(null)}
>
  <AlertDialogContent>
    <AlertDialogHeader>
      <AlertDialogTitle>Shutdown Container?</AlertDialogTitle>
      <AlertDialogDescription>
        This will gracefully shut down <strong>{displayName}</strong> by
        sending a shutdown signal to the init process. The container will have
        30 seconds to clean up before being forcefully stopped.
      </AlertDialogDescription>
    </AlertDialogHeader>
    <AlertDialogFooter>
      <AlertDialogCancel disabled={isShuttingDown}>Cancel</AlertDialogCancel>
      <AlertDialogAction
        onClick={handleShutdown}
        disabled={isShuttingDown}
        className="bg-yellow-600 hover:bg-yellow-700"
      >
        {isShuttingDown ? "Shutting down..." : "Shutdown Container"}
      </AlertDialogAction>
    </AlertDialogFooter>
  </AlertDialogContent>
</AlertDialog>
```

Why these dialog messages:

- Start: Emphasizes resource consumption (informative, not scary)
- Shutdown: Explains graceful vs forceful, mentions 30s timeout (educates user on the difference from Stop)
- Colors: green for Start (positive action), yellow for Shutdown (caution but not destructive)

Existing Stop and Delete dialogs remain unchanged (no regression).
</action>
<verify>
Check state type expanded:

```bash
grep -A 2 "confirmDialog.*useState" apps/dashboard/src/components/containers/detail/container-header.tsx | grep '"start".*"shutdown"'
```

Verify button onClick changes:

```bash
grep -B 5 'setConfirmDialog.*"start"' apps/dashboard/src/components/containers/detail/container-header.tsx | grep "Start"
grep -B 5 'setConfirmDialog.*"shutdown"' apps/dashboard/src/components/containers/detail/container-header.tsx | grep "Shutdown"
```

Check AlertDialog components added:

```bash
grep "Start Container?" apps/dashboard/src/components/containers/detail/container-header.tsx
grep "Shutdown Container?" apps/dashboard/src/components/containers/detail/container-header.tsx
```

Count total AlertDialog components (should be 4: start, shutdown, stop, delete):

```bash
grep -c "AlertDialogTitle" apps/dashboard/src/components/containers/detail/container-header.tsx
```

TypeScript check:

```bash
cd apps/dashboard && npx tsc --noEmit --project tsconfig.json 2>&1 | grep -i "container-header" || echo "No TS errors in container-header"
```

  </verify>
  <done>
`confirmDialog` state supports "start" and "shutdown" values, Start and Shutdown buttons trigger dialogs instead of direct execution, AlertDialog components render with appropriate messaging and styling, TypeScript compiles without errors.
  </done>
</task>

</tasks>

<verification>
## Manual Testing

1. **Start Confirmation:**
   - Navigate to container detail page for a stopped container
   - Click "Start" button
   - Expected: AlertDialog appears with "Start Container?" title
   - Dialog describes resource consumption
   - Cancel dismisses dialog, container remains stopped
   - Confirm starts container and shows loading state

2. **Shutdown Confirmation:**
   - Navigate to container detail page for a running container
   - Click "Shutdown" button
   - Expected: AlertDialog appears with "Shutdown Container?" title
   - Dialog explains graceful shutdown with 30s timeout
   - Cancel dismisses dialog, container remains running
   - Confirm shuts down container with loading state

3. **Regression Check - Stop:**
   - Click "Stop" on running container
   - Expected: Still shows confirmation dialog (no change)

4. **Regression Check - Delete:**
   - Click "Delete" on any container
   - Expected: Still shows destructive confirmation dialog (no change)

## Code Verification

```bash
# Verify state type
grep "confirmDialog.*useState" apps/dashboard/src/components/containers/detail/container-header.tsx

# Count dialogs (should be 4)
grep "AlertDialogTitle" apps/dashboard/src/components/containers/detail/container-header.tsx

# TypeScript check
cd apps/dashboard && npx tsc --noEmit
```

</verification>

<success_criteria>

- [ ] `confirmDialog` state type includes "start" and "shutdown" values
- [ ] Start button onClick calls `setConfirmDialog("start")` instead of `handleStart`
- [ ] Shutdown button onClick calls `setConfirmDialog("shutdown")` instead of `handleShutdown`
- [ ] Start AlertDialog component added with informative messaging
- [ ] Shutdown AlertDialog component added with graceful shutdown explanation
- [ ] Start dialog uses green styling (positive action)
- [ ] Shutdown dialog uses yellow styling (caution)
- [ ] Both dialogs show loading states during execution
- [ ] Stop and Delete dialogs unchanged (no regression)
- [ ] TypeScript compilation succeeds
- [ ] All four lifecycle actions require confirmation before execution
      </success_criteria>

<output>
After completion, create `.planning/phases/04-container-management/04-11-SUMMARY.md`
</output>
